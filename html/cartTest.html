<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kampech</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="icon" href="/Kumpech_logo_noText.png">
    <script src="/index.js"></script>
</head>

<body>
    <header>
        <div class="headerLeft">
            <a href="/index.html" class="nome_logo"><img src="/Kumpech_logo_noText.png" alt="logo" class="logo">
                <h1>Kampech</h1>
            </a>

        </div>
        <div class="headerRight">
            <input type="text" placeholder="Buscar.." class="searchBar" id="headerSearchBar">
            <button onclick="searchBar_slide()" class="searchButton">
                <img src="/searchIcon.svg" alt="searchIcon" class="searchIcon">
            </button>
            <a href="#" class="accountIcon" onclick="handleAuthenticationResponse()">
                <img src="/accountIcon.svg" alt="accountIcon">
            </a>
            <button class="cartIcon" onclick="cartAnimation()">
                <img src="/cartIcon.svg" alt="cartIcon">
            </button>
        </div>
        <div class="cartPopUp" id="cartContainer">
            <button class="close_button" onclick="cartAnimation()">
                <img class="close_button__img" alt="close_button" src="/close_button.svg">
                <h4 class="close_button__title">Fechar</h4>
            </button>
            <div class="cartPopUp__item" id="cartItems">

            </div>
            <hr style="border: 1px solid black; width: 90%; align-self: center; margin-top: 10%;">
            <div class="cartPopUp__priceContainer">
                <h2>Total</h2>
                <h2>R$696,90</h2>
            </div>
            <a id="finishCart" href="">
                <p>Finalizar<br>pedido</p>
            </a>
            <p id="finePrint">*taxas calculadas na finalização da compra</p>
        </div>
    </header>

    <main class="index">
        <a href="/custom.html" class="keyboardCustom_link">
            <div class="container">
                <img src="/keyboardCustom.png" alt="keyboardCustom" class="keyboardCustom">
            </div>
        </a>

        <a href="/products.html" class="keyboardBuy_link">
            <div class="container">
                <img src="/keyboardBuy.png" alt="keyboardBuy" class="keyboardBuy">
            </div>
        </a>
    </main>

    <footer>
    </footer>

    <script>
        // Função para redirecionar com base na resposta do servidor
        function handleAuthenticationResponse(response) {
            if (response.ok) {
                // Se o servidor retornar uma resposta bem-sucedida, redireciona para personalInfo.html
                window.location.href = '/personalInfo.html';
            } else {
                // Caso contrário, redireciona para login.html
                window.location.href = '/login.html';
            }
        }

        // Ouvinte de eventos para redirecionar quando o usuário clicar no ícone de conta
        document.querySelector('.accountIcon').addEventListener('click', function (event) {
            event.preventDefault(); // Impede o comportamento padrão do link

            fetch('/getPersonalInfo')
                .then(handleAuthenticationResponse)
                .catch(error => {
                    console.log('Erro ao verificar autenticação:', error);
                    // Em caso de erro, redireciona para login.html por padrão
                    window.location.href = '/login.html';
                });
        });
        // Função para adicionar um item ao carrinho
        function addToCart(item) {
            var cartItems = document.getElementById("cartItems");

            var itemElement = document.createElement("div");
            itemElement.classList.add("cartPopUp__item");

            var itemHTML = `
    <div class="cartPopUp__item__left">
      <img class="cartPopUp__item__left__img" src="/keyboardExample.png">
    </div>
    <div class="cartPopUp__item__right">
      <h1 class="cartPopUp__item__right__title">Teclado Customizado</h1>
      <h2 class="cartPopUp__item__right__desc" id="cartDescription">${item.description}</h2>
      <div class="cartPopUp__item__right__bottom">
        <input class="quantity" type="number" name="quantity" min="0" value="1">
        <h1 class="cartPopUp__item__right__bottom__price">R$69,90</h1>
      </div>
    </div>
  `;

            itemElement.innerHTML = itemHTML;
            cartItems.appendChild(itemElement);

            // Atualiza o elemento com o ID "cartDescription" com a descrição do item
            document.getElementById("cartDescription").innerText = item.description;
        };
        // Função para carregar os dados do item e adicioná-lo ao carrinho
        function loadItemAndAddToCart() {
            fetch('/custom', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ /* dados do item, se necessário */ })
            })
                .then(response => response.json())
                .then(data => {
                    // Obtém a descrição do JSON retornado
                    const description = data.description;

                    // Cria o objeto item com a descrição obtida
                    const item = {
                        description: description
                    };

                    // Adiciona o item ao carrinho
                    addToCart(item);
                })
                .catch(error => {
                    console.log('Erro ao carregar item:', error);
                });
        }

        // Ouvinte de eventos para o carregamento da página
        document.addEventListener('DOMContentLoaded', loadItemAndAddToCart);
    </script>
</body>

</html>